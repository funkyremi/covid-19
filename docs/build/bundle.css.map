{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../App.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import { reasons, profileSchema } from \"./lib/data\";\n  import { profiles, settings } from \"./lib/stores\";\n  import { generatePdf } from \"./lib/pdf\";\n  import { guid } from \"./lib/utils\";\n  import SignaturePad from \"signature_pad\";\n\n  profiles.useLocalStorage();\n  settings.useLocalStorage();\n\n  let createProfileWindow = false;\n  let editProfileWindow = false;\n  let newProfile = { id: guid() };\n  let profileToEdit = {};\n  let signaturePad;\n\n  function activeReason(selectedReason, reason) {\n    return selectedReason && reason.shortText === selectedReason.shortText;\n  }\n  function selectProfile(profile) {\n    const newProfiles = [...$profiles].map(p => ({ ...p, selected: false }));\n    const selectedProfileIndex = newProfiles.findIndex(\n      p => p.id === profile.id\n    );\n    newProfiles[selectedProfileIndex].selected = true;\n    profiles.update(() => newProfiles);\n  }\n  function handleNewProfile() {\n    newProfile.signature = signaturePad.toDataURL();\n    const oldProfiles = [...$profiles].map(p => ({ ...p, selected: false }));\n    const newProfiles = [...oldProfiles, { ...newProfile, selected: true }];\n    profiles.update(() => newProfiles);\n    createProfileWindow = false;\n    newProfile = { id: guid() };\n  }\n  function handleExistingProfile() {\n    profileToEdit.signature = signaturePad.toDataURL();\n    const oldProfiles = [...$profiles].filter(p => p.id !== profileToEdit.id).map(p => ({ ...p, selected: false }));\n    const newProfiles = [...oldProfiles, { ...profileToEdit, selected: true }];\n    profiles.update(() => newProfiles);\n    editProfileWindow = false;\n  }\n  function deleteProfile(profile) {\n    const tempProfiles = $profiles;\n    const index = tempProfiles.findIndex(p => p.id === profile.id);\n    tempProfiles.splice(index, 1);\n    profiles.update(() => tempProfiles);\n  }\n  function editProfile(profile) {\n    editProfileWindow = !editProfileWindow;\n    profileToEdit = profile;\n  }\n  async function generate(profile, settings) {\n    const pdfBlob = await generatePdf(profile, settings);\n    downloadBlob(pdfBlob, `attestation.pdf`);\n  }\n  function downloadBlob(blob, fileName) {\n    const link = document.createElement(\"a\");\n    var url = URL.createObjectURL(blob);\n    link.href = url;\n    link.download = fileName;\n    document.body.appendChild(link);\n    link.click();\n  }\n  function getProfileName(profile) {\n    return profile.intitule || `${profile.prenom} ${profile.nom}`;\n  }\n  function initSignature() {\n    setTimeout(() => {\n      const canvas = document.querySelector(\"canvas\");\n      signaturePad = new SignaturePad(canvas);\n    }, 0);\n    return '';\n  }\n  function loadSignature(profile) {\n    setTimeout(() => {\n      const canvas = document.querySelector(\"canvas\");\n      signaturePad = new SignaturePad(canvas);\n      if (profile.signature) {\n        signaturePad.fromDataURL(profile.signature, {ratio: 1});\n      }\n    }, 0);\n    return '';\n  }\n</script>\n\n<style>\n  .margin-top {\n    margin-top: 10px;\n  }\n  .margin-left {\n    margin-left: 5px;\n  }\n  main {\n    margin-top: 20px;\n    padding: 30px;\n  }\n  .container {\n    max-width: 600px;\n  }\n  canvas {\n    border: 1px solid #ced4da;\n    border-radius: 5px;\n  }\n  .clickable {\n    cursor: pointer;\n  }\n  p {\n    color: #495057;\n  }\n</style>\n\n<main>\n  <div class=\"container\">\n    <!-- List profiles -->\n    <div class=\"list-group\">\n      {#each $profiles as profile}\n        <a\n          href=\"javascript:void(0)\"\n          class=\"list-group-item list-group-item-action\"\n          class:active={profile.selected}\n          on:click={() => selectProfile(profile)}>\n          <i class=\"fas fa-user\" />\n          &nbsp; {getProfileName(profile)}\n          <button\n            class=\"btn btn-light btn-sm float-right margin-left\"\n            on:click|stopPropagation={() => deleteProfile(profile)}>\n            <i class=\"fas fa-times\" />\n          </button>\n          <button\n            class=\"btn btn-light btn-sm float-right\"\n            on:click|stopPropagation={() => editProfile(profile)}>\n            <i class=\"fas fa-edit\" />\n          </button>\n        </a>\n      {/each}\n      <a\n        href=\"javascript:void(0)\"\n        class=\"list-group-item list-group-item-action\"\n        on:click={() => (createProfileWindow = !createProfileWindow)}>\n        <i class=\"fas fa-plus\" />\n        &nbsp; Nouveau profil\n      </a>\n    </div>\n\n    {#if createProfileWindow}\n      <div>\n        <form on:submit|preventDefault={handleNewProfile}>\n          {#each profileSchema as field}\n            <input\n              class=\"form-control margin-top\"\n              type=\"text\"\n              bind:value={newProfile[field.key]}\n              placeholder={field.value}\n              required={field.key !== \"intitule\"} />\n          {/each}\n          <div class=\"text-center margin-top\">\n            <p>Signature (optionnel)&nbsp;&nbsp;<span class=\"clickable\" on:click={signaturePad.clear()}><i class=\"fas fa-undo\" /></span></p>\n            <canvas>{initSignature()}</canvas>\n          </div>\n          <div class=\"text-center\">\n            <button\n              type=\"submit\"\n              class=\"btn btn-outline-primary margin-top center-block\">\n              Enregistrer\n            </button>\n          </div>\n        </form>\n      </div>\n    {/if}\n\n    {#if editProfileWindow}\n      <div>\n        <form on:submit|preventDefault={handleExistingProfile}>\n          {#each profileSchema as field}\n            <input\n              class=\"form-control margin-top\"\n              type=\"text\"\n              bind:value={profileToEdit[field.key]}\n              placeholder={field.value}\n              required={field.key !== \"intitule\"} />\n          {/each}\n          <div class=\"text-center margin-top\">\n            <p>Signature (optionnel)&nbsp;&nbsp;<span class=\"clickable\" on:click={signaturePad.clear()}><i class=\"fas fa-undo\" /></span></p>\n            <canvas>{loadSignature(profileToEdit)}</canvas>\n          </div>\n          <div class=\"text-center\">\n            <button\n              type=\"submit\"\n              class=\"btn btn-outline-primary margin-top center-block\">\n              Enregistrer\n            </button>\n          </div>\n        </form>\n      </div>\n    {/if}\n\n    <br />\n\n    {#if $profiles.find(p => p.selected)}\n      <div class=\"list-group\">\n        {#each reasons as reason}\n          <a\n            href=\"javascript:void(0)\"\n            class=\"list-group-item list-group-item-action\"\n            class:active={activeReason($settings.selectedReason, reason)}\n            on:click={() => settings.update(() => ({\n                ...$settings,\n                selectedReason: reason\n              }))}>\n            <i class=\"fas fa-{reason.icon}\" />\n            &nbsp; {reason.shortText}\n          </a>\n        {/each}\n      </div>\n\n      <br />\n      <label for=\"created-since\">\n        Attestation créée il y a {$settings.createdXMinutesAgo} minute{$settings.createdXMinutesAgo > 1 ? 's' : ''}\n      </label>\n      <input\n        type=\"range\"\n        class=\"custom-range\"\n        min=\"0\"\n        max=\"60\"\n        step=\"1\"\n        bind:value={$settings.createdXMinutesAgo}\n        id=\"created-since\" />\n      <br />\n      <br />\n      <button\n        type=\"button\"\n        on:click={() => generate($profiles.find(p => p.selected), $settings)}\n        class=\"btn btn-outline-primary btn-lg btn-block\">\n        <i class=\"fas fa-file-pdf\" />\n        &nbsp; Générer l'attestation\n      </button>\n    {/if}\n  </div>\n</main>\n"
  ],
  "names": [],
  "mappings": "AAuFE,WAAW,cAAC,CAAC,AACX,UAAU,CAAE,IAAI,AAClB,CAAC,AACD,YAAY,cAAC,CAAC,AACZ,WAAW,CAAE,GAAG,AAClB,CAAC,AACD,IAAI,cAAC,CAAC,AACJ,UAAU,CAAE,IAAI,CAChB,OAAO,CAAE,IAAI,AACf,CAAC,AACD,UAAU,cAAC,CAAC,AACV,SAAS,CAAE,KAAK,AAClB,CAAC,AACD,MAAM,cAAC,CAAC,AACN,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,OAAO,CACzB,aAAa,CAAE,GAAG,AACpB,CAAC,AACD,UAAU,cAAC,CAAC,AACV,MAAM,CAAE,OAAO,AACjB,CAAC,AACD,CAAC,cAAC,CAAC,AACD,KAAK,CAAE,OAAO,AAChB,CAAC"
}